<html>
  <head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7/web3.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="https://unpkg.com/mvp.css">
    <script src="etf.js" charset="utf-8"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const ethEnabled = () => {
          if (window.ethereum) {
            window.web3 = new Web3(window.ethereum);
            window.ethereum.enable();
            document.getElementById("account").value = window.ethereum.selectedAddress;
            return true;
          }
          return false;
        }
        if(!ethEnabled()){
          alert("web3 not connected! check metamask");
        }
        else if(window.ethereum.networkVersion != 3) {
          alert("change network to ropsten");
        }
        else {
          setContract();
          document.getElementById("etf").value = window.etf.options.address;
          getBalance(window.ethereum.selectedAddress, "acc");
          getBalance(window.etf.options.address, "etf");
          window.etf.events.Transfer().on('data', function(){
            getBalance(window.ethereum.selectedAddress, "acc");
            getBalance(window.etf.options.address, "etf");
          });

          window.etf.events.Rebalance().on('data', function(){
            getBalance(window.ethereum.selectedAddress, "acc");
            getBalance(window.etf.options.address, "etf");
          });
        }
      });

    </script>
  </head>
  <body>
    <nav style="display: flex; align-items: center; justify-content: center;">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li>Status</li>
        <li><a href="logs.html">Logs</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
    <div style="  display: flex; align-items: center; justify-content: center;">
      <div class="" style="width:448px;">
        <form method="GET" action="a.html" id="Info">
          <header>
            <h3>Account Status</h3>
          </header>
          <label>Connected Account</label> <input id="account" style="width:400" type="text" readonly/>
          <label>CETF Balance</label> <input id="acc-etfBalance" style="width:400" type="text" readonly/>
          <label>BaseCoin Balance</label> <input id="acc-aBalance" style="width:400" type="text" readonly/>
          <label>Token B Balance</label> <input id="acc-bBalance" style="width:400" type="text" readonly/>
          <label>Token C Balance</label> <input id="acc-cBalance" style="width:400" type="text" readonly/>
        </form>
      </div>
      <div class="" style="width:448px;">
        <form method="GET" action="a.html" id="Info">
          <header>
            <h3>ETF Status</h3>
          </header>
          <label>ETF address</label> <input id="etf" style="width:400" type="text" readonly/>
          <label>CETF totalSupply</label> <input id="etf-etfBalance" style="width:400" type="text" readonly/>
          <label>BaseCoin Balance</label> <input id="etf-aBalance" style="width:400" type="text" readonly/>
          <label>Token B Balance</label> <input id="etf-bBalance" style="width:400" type="text" readonly/>
          <label>Token C Balance</label> <input id="etf-cBalance" style="width:400" type="text" readonly/>
        </form>
      </div>
    </div>
  </body>
</html>
